#!/usr/bin/env node

var console = require("console");
var exec    = require("child_process").exec;

console.log("Starting peru sync");
exec("peru sync", function(error, stdout, stderr){
  console.log("Finish peru sync");
  console.log(stderr);

  if (!error) {
    console.log("Starting prebuild videojs-contrib-hls");
    exec("cd videojs-contrib-hls && npm install && npm uninstall video.js --save && npm install ../video.js --save", function(error, stdout, stderr){
      console.log("Finish prebuild videojs-contrib-hls");
      console.log(stderr);

      if (!error) {
        console.log("Starting prebuild videojs-contrib-ads");
        exec("cd videojs-contrib-ads && npm install && npm uninstall video.js --save-dev && npm install ../video.js --save-dev", function(error, stdout, stderr){
          console.log("Finish prebuild videojs-contrib-ads");
          console.log(stderr);

          if (!error) {
            console.log("Starting prebuild videojs-ima");
            exec("cd videojs-ima && npm install && npm uninstall video.js --save && npm uninstall videojs-contrib-ads --save && npm install ../video.js --save && npm install ../videojs-contrib-ads --save", function(error, stdout, stderr){
              console.log("Finish prebuild videojs-ima");
              console.log(stderr);
            });
          }
        });
      }
    });
  }
});



